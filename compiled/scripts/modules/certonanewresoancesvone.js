window.recommendedproducts=null;var certonaRecommendations=function(e){window.recommendedproducts=e,require(["jquery","underscore","modules/api"],function(e,s,c){var r=function(c,r){var i=" ";console.log(c),s.each(c,function(e,r){if(i+='<div class="item">',i+='<div class="mz-productlist-item" data-mz-product="'+c[r].productCode+'">',i+='<div class="mz-productlisting mz-productlist-tiled" data-mz-product="'+c[r].productCode+'">',i+='<div class="mz-productlisting-image">',i+='<a href="/'+c[r].content.seoFriendlyUrl+"/p/"+c[r].productCode+'?rrec=true">',i+=c[r].content.productImages.length>0?'<img src="'+s.first(c[r].content.productImages).imageUrl+'?max=210" alt="'+c[r].content.productName+'">':'<span class="mz-productlisting-imageplaceholder"><span class="mz-productlisting-imageplaceholdertext">Image coming soon..</span></span>',i+="</a>",i+='<div class="quick-view">',i+='<a href="javascript:void(0)" data-pro-id="'+c[r].productCode+'">QUICK VIEW',i+="</a>",i+="</div>",i+='<div class="wishlist-icon" id="'+c[r].productCode+'">',i+='<a href="#" id="'+c[r].productCode+'">',i+="</a>",i+="</div>",!c[r].priceRange&&c[r].price.salePrice){i+='<div class="mz-sales-ribbon">',i+='<span itemprop="price" class="mz-price is-saleprice">';var o=c[r].price.price-c[r].price.salePrice,t=o/c[r].price.price,a=100*t,n=a.toPrecision(2);i+='<span class="mz-price-discountname">'+n+"%</span>",i+="</span>",i+="</div>"}if(i+="</div>",i+='<div class="mz-productlisting-info">',i+='<a class="mz-productlisting-title" href="/'+c[r].content.seoFriendlyUrl+"/p/"+c[r].productCode+'?rrec=true">'+c[r].content.productName+"</a>",i+='<div itemprop="priceSpecification" itemscope="" itemtype="http://schema.org/PriceSpecification" class="mz-pricestack">',i+="<span>",c[r].priceRange)i+='<span itemprop="minPrice" class="mz-pricestack-price-lower">$'+c[r].priceRange.lower.price.toFixed(2)+"</span>",i+='<span itemprop="maxPrice" class="mz-pricestack-price-up">$'+c[r].priceRange.upper.price.toFixed(2)+"</span>";else{var d="";c[r].price.salePrice&&(d=" is-crossedout"),i+='<span class="mz-price'+d+'">$'+c[r].price.price+"</span>",c[r].price.salePrice&&(i+='<span itemprop="price" class="mz-price is-saleprice">$'+c[r].price.salePrice+"</span>")}i+="</span>",i+="</div>",i+="</div>",i+='<div class="mz-productlisting-is-personalize">',i+='<a href="javascript:void(0)"></a>',i+="</div>",i+="</div>",i+="</div>",i+="</div>"}),e(r).html('<div class="pdp-related-products"><div class="clear"></div><div class="echi-shi-related-products-slider"><div class="owl-carousel owl-theme">'+i+"</div></div></div>"),e(".echi-shi-related-products-slider .owl-carousel").owlCarousel({loop:!0,margin:10,nav:!0,responsive:{0:{items:2},600:{items:2},1e3:{items:4}}})},i=function(i,o,t){var a="/api/commerce/catalog/storefront/productsearch/search/?filter="+i+"&pageSize=200";c.request("GET",a).then(function(c){for(var i,o=[],a=0;a<t.resonance.schemes.length;a++)for(var n=0;n<t.resonance.schemes[a].items.length;n++)i=t.resonance.schemes[a].items[n].id,o.push(i);var d=[];d.items=[];for(var p=0;p<o.length;p++)for(var l=0;l<c.items.length;l++)o[p]==c.items[l].productCode&&d.items.push(c.items[l]);var m,h="#recommended_products_slot_cart",u="#recommended_products_slot_1",g="#recommended_products_slot_2",v="#recommended_products_slot";s.each(t.resonance.schemes,function(c,i){if("addtocart1_rr"===t.resonance.schemes[i].scheme)r(d.items,h);else if("category1_rr"===t.resonance.schemes[i].scheme)r(d.items,v);else if("product1_rr"===t.resonance.schemes[i].scheme){var o=s.findWhere(t.resonance.schemes,{scheme:"product1_rr"}),a=s.pluck(o.items,"id");m=s.filter(d.items,function(e){return s.contains(a,e.productCode)}),r(m,u),m.length>0&&"yes"===t.resonance.schemes[i].display&&e(".recom_slot-heading_1").show()}else if("product2_rr"===t.resonance.schemes[i].scheme){var n=s.difference(d.items,m);r(n,g),n.length>0&&"yes"===t.resonance.schemes[i].display&&e(".recom_slot-heading_2").show()}})})},o=require.mozuData("pagecontext"),t=(o.pageType,0);globalNameSpace.callRecomm=function(e){if(console.log("CallBackFunction Trigger"),e){var s=e;window.rec=s;for(var c,r,o,a=[],n=[],d=0;d<e.resonance.schemes.length;d++)if("addtocart1_rr"===e.resonance.schemes[d].scheme){if(o=!0,"yes"===e.resonance.schemes[d].display){r=e.resonance.schemes[d].items.length;for(var p=0;p<e.resonance.schemes[d].items.length;p++)c=e.resonance.schemes[d].items[p].id,n[p+d*e.resonance.schemes[d].items.length]=c}}else if(o=!1,"yes"===e.resonance.schemes[d].display){r=e.resonance.schemes[d].items.length;for(var l=0;l<e.resonance.schemes[d].items.length;l++)c=e.resonance.schemes[d].items[l].id,a[l+d*e.resonance.schemes[d].items.length]=c}for(var m="productCode eq ",h=0;h<a.length;h++)m+=h<a.length-1?a[h]+" or productCode eq ":a[h];if(0===n.length&&!o&&a.length>=1)i(m,0,e);else if(o&&0===a.length&&n.length>=1){for(var u="productCode eq ",g=0;g<n.length;g++)u+=g<n.length-1?n[g]+" or productCode eq ":n[g];i(u,1,e),t=0,n=[],o=!1}}},setTimeout(function(){globalNameSpace.callRecomm(window.recommendedproducts)},500)})};