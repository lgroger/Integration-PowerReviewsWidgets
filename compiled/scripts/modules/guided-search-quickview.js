require(["modules/jquery-mozu","underscore","modules/backbone-mozu","hyprlive","modules/models-faceting","modules/api","modules/models-product","modules/cart-monitor","modules/views-productimages","modules/models-faceting","hyprlivecontext","modules/added-to-cart","modules/powerreviews","modules/soft-cart","vendor/wishlist"],function(e,t,o,i,a,r,n,c,d,s,l,u,m,p,h){function g(){e(".trigger-login").trigger("click"),e("#cboxOverlay").show(),e("#mz-quick-view-container").fadeOut(350),e("#mz-quick-view-container").empty()}function v(t,o){t=t.toJSON();var a=i.getThemeSetting("productAttributes"),r=0,n=0,c="asImages";for(r=0;r<t.properties.length;r++)if(t.properties[r].attributeFQN===a.displayCrossSell){c=t.properties[r].values[0].value;break}var d=null,s=null,l=null,u=null,m=o.items.length>8?8:o.items.length;for(r=0;m>r;r++)if("asColors"===c){for(e("#color-swatch-elem > span").text("Colors: "),n=0;n<o.items[r].properties.length;n++)if(o.items[r].properties[n].attributeFQN===a.colorHex&&""!==o.items[r].properties[n].values[0].value){d=o.items[r].properties[n].values[0].value;break}""!==d&&(s=document.createElement("a"),e(s).attr("href","/p/"+o.items[r].productCode).addClass("swatch-color").css("background-color",d),l=document.createElement("li"),e(l).append(s),e("ul[color-swatch-data]").append(l))}else e("#color-swatch-elem > span").text("Images: "),o.items[r].content.productImages.length>0&&""!==o.items[r].content.productImages[0].imageUrl&&(u=o.items[r].content.productImages[0].imageUrl+"?max=22",s=document.createElement("a"),e(s).attr("href","/p/"+o.items[r].productCode),e("<img/>").attr("src",u).appendTo(s),l=document.createElement("li"),e(l).addClass("swatch-image").css("border-radius","0").append(s),e("ul[color-swatch-data]").append(l));o.items.length>6&&(s=document.createElement("a"),"asColors"==c?e(s).attr("href",window.location.origin+"/p/"+t.productCode).attr("class","more-link").html("See More Colors"):e(s).attr("href",window.location.origin+"/p/"+t.productCode).attr("class","more-link").html("See More Images"),l=document.createElement("li"),e(l).addClass("more-link").append(s),e("ul[color-swatch-data]").append(l))}function w(){m.writeProductListBoxes()}r.on("error",function(t){e(".mz-messagebar").empty().html(t.message)});var f=o.MozuView.extend({templateName:"modules/product/quickview",autoUpdate:["quantity"],additionalEvents:{"change [data-mz-product-option]":"onOptionChange","blur [data-mz-product-option]":"onOptionChange","click #add-to-cart":"addToCart"},render:function(){var a=this;o.MozuView.prototype.render.apply(this),this.$("[data-mz-is-datepicker]").each(function(o,r){e(r).dateinput().css("color",i.getThemeSetting("textColor")).on("change  blur",t.bind(a.onOptionChange,a))})},afterRender:function(){var t=this;e(".product-image-slider .owl-carousel").length>0&&(setTimeout(function(){e(".product-image-slider .owl-next, .product-image-slider .owl-prev").html(""),e(".product-image-slider .owl-carousel").owlCarousel({dots:!0,loop:!0,nav:!0,items:4}).owlCarousel("refresh"),e(".product-image-slider .owl-carousel .owl-item").length<4&&(e(".product-image-slider .owl-prev").hide(),e(".product-image-slider .owl-next").hide()),e(".product-video .owl-next, .product-video .owl-prev").html(""),e(".product-video .owl-carousel").owlCarousel({dots:!1,loop:!1,nav:!0,items:1}).owlCarousel("refresh"),e(".product-video .owl-carousel .owl-item").length<2&&(e(".product-video .owl-next").hide(),e(".product-video .owl-prev").hide())},50),e(".item > img").click(function(){e(".product-image > img").show(),e(".product-image > img").attr("src",e(this).attr("src")),e("#video-frame").hide(),e(".product-image > iframe").attr("src","")})),e("div[video-data] > img").click(function(){e(".product-image > img").hide(),e(".product-image > iframe").attr("src","http://www.youtube.com/embed/"+e(this).parent().attr("video-data")).show()}),e("#video-frame").hide(),e("#addThis-conainer").attr("data-url",window.location.origin+e("#addThis-conainer").attr("data-url"));var o=setInterval(function(){e(".at4-share-outer.addthis-smartlayers.addthis-smartlayers-desktop").length>0&&(e(".at4-share-outer.addthis-smartlayers.addthis-smartlayers-desktop").remove(),clearInterval(o))},200),i=e("ul[color-swatch-data]").attr("color-swatch-data");if(void 0!==i){var a="/api/commerce/catalog/storefront/products/?filter="+i+"&responseObject=items(content, properties)";r.request("GET",a,{}).then(function(e){v(t.model,e)})}e("#mz-quick-view-container .qtyplus").click(function(t){t.preventDefault();var o=e(this).attr("field"),i=parseInt(e("#mz-quick-view-container input[name="+o+"]").val(),10);isNaN(i)?e("#mz-quick-view-container input[name="+o+"]").val(1):e("#mz-quick-view-container input[name="+o+"]").val(i+1),e('.custom-qty input[data-mz-value="quantity"]').trigger("change")}),e("#mz-quick-view-container .qtyminus").click(function(t){t.preventDefault();var o=e(this).attr("field"),i=parseInt(e("#mz-quick-view-container input[name="+o+"]").val(),10);!isNaN(i)&&i>1?e("#mz-quick-view-container input[name="+o+"]").val(i-1):e("#mz-quick-view-container input[name="+o+"]").val(1),e('.custom-qty input[data-mz-value="quantity"]').trigger("change")}),e("#mz-quick-view-container").children(".qtyminus,.qtyplus").css({"background-color":"transparent","fonts-size":"1rem"}),e(".addToWishlist-btn-extra").click(function(){t.addToWishlist()}),w(this.productCode)},onOptionChange:function(t){return this.configure(e(t.currentTarget))},configure:function(e){var t,o=e.val(),i=e.data("mz-product-option"),a=e[0],r="checkbox"!==a.type&&"radio"!==a.type||a.checked,n=this.model.get("options").get(i);n&&("YesNo"===n.get("attributeDetail").inputType?n.set("value",r):r&&(t=n.get("value"),t===o||void 0===t&&""===o||n.set("value",o)))},addToCart:function(){this.model.addToCart()},addToWishlist:function(){require.mozuData("user").isAuthenticated?h.initoWishlist(this.model):g()},checkLocalStores:function(t){var o=this;t.preventDefault(),this.model.whenReady(function(){var i=e(t.currentTarget).parents("[data-mz-localstoresform]"),a=i.find("[data-mz-localstoresform-input]");a.length>0&&(a.val(JSON.stringify(o.model.toJSON())),i[0].submit())})},update:function(e){this.model=e,this.render()},initialize:function(){var t=this;this.on("render",this.afterRender),this.$("[data-mz-product-option]").each(function(){var o,i,a=e(this);if(a.val())switch(a.attr("type")){case"checkbox":case"radio":o=a.prop("checked"),i=!!a.attr("checked"),(o&&!i||i&&!o)&&t.configure(a);break;default:t.configure(a)}})}});e(document).ready(function(){e(document).on("click",".quick-view > a[data-pro-id]",function(t){var o=e(".categoryid").val(),a=e(t.target).attr("data-pro-id"),n="/api/commerce/catalog/storefront/productsearch/search/?filter=categoryId req "+o+"&pageSize=200";r.request("GET",n).then(function(o){console.log(o);var r=new s.FacetedProductCollection(o);console.log(a);var n=r.get("items").where({productCode:a}),d=n[0];console.log(d),d.on("addedtocart",function(t){t&&t.prop("id")?e("#mz-quick-view-container").fadeOut(100,function(){e("#mz-quick-view-container").remove(),u.proFunction(d),c.addToCount(d.get("quantity")),p.update()}):d.trigger("error",{message:i.getLabel("unexpectedError")})}),d.on("addedtowishlist",function(){e("#add-to-wishlist").prop("disabled","disabled").text(i.getLabel("addedToWishlist"))}),e("body").append('<div id="mz-quick-view-container"></div>'),window.productView=new f({el:e("#mz-quick-view-container"),messagesEl:e("[data-mz-message-bar]"),model:d,productCode:a}),window.productView.render(),e("#mz-quick-view-container").fadeIn(350),t.preventDefault()})}),e(document).on("click","#mz-quick-view-container-close, #mz-quick-view-container, .popup.quickview-popup",function(t){t.target===t.currentTarget&&(e("#mz-quick-view-container").fadeOut(350),e("#mz-quick-view-container").remove())})})});