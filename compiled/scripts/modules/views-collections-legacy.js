define(["modules/jquery-mozu","underscore","hyprlive","modules/backbone-mozu","modules/models-faceting","modules/views-productlists","modules/views-paging"],function(e,a,t,r,n,o,d){function i(i){var l,s={},c=i.$body.data("mz-category"),u=i.$body.data("mz-search");u?(l=new n.SearchResult(i.data),l.setQuery(u)):l=new n.Category(i.data),c&&l.setHierarchy("categoryId",c),a.extend(s,{pagingControls:new d.PagingControls({el:i.$body.find("[data-mz-pagingcontrols]"),model:l}),pageNumbers:new d.PageNumbers({el:i.$body.find("[data-mz-pagenumbers]"),model:l}),pageSort:new d.PageSortView({el:i.$body.find("[data-mz-pagesort]"),model:l}),productList:new o.List({el:i.$body.find("[data-mz-productlist]"),model:l})}),i.$facets.length>0&&(s.facetPanel=new o.FacetingPanel({el:i.$facets,model:l})),r.history.start({pushState:!0,root:window.location.pathname});var g=new r.Router,m=!1;l.on("facetchange",function(e){m||g.navigate(e),m=!1},g),l.on("change:pageSize",l.updateFacets,l),a.invoke(s,"delegateEvents");var h=t.getThemeSetting("defaultPageSize");return g.route("*all","filter",function(){{var t=e.extend({pageSize:h},e.deparam()),r={};l.lastRequest}t.startIndex||(r.resetIndex=!0),l.hierarchyField&&t[l.hierarchyField]!==l.hierarchyValue&&(l.setHierarchy(l.hierarchyField,t[l.hierarchyField]||c),r.force=!0),l.set(a.pick(t,"pageSize","startIndex","facetValueFilter","sortBy"),{silent:!0}),m=!0,l.updateFacets(r)}),s}return{createFacetedCollectionViews:i}});