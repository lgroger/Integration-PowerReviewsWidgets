define("modules/models-location",["modules/jquery-mozu","modules/backbone-mozu","hyprlive","modules/api"],function(o,t){var e=t.MozuModel.extend({mozuType:"location",idAttribute:"code"}),n=t.MozuModel.extend({mozuType:"locations",relations:{items:t.Collection.extend({model:e})}});return{Location:e,LocationCollection:n}}),require(["modules/jquery-mozu","hyprlive","modules/backbone-mozu","modules/models-location","modules/models-product","hyprlivecontext"],function(o,t,e,n,i,a){var r=t.getLabel("positionError"),d=e.MozuView.extend({templateName:"modules/location/locations",initialize:function(){var o=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){delete o.positionError,o.populate(t)},function(t){t.code!==t.PERMISSION_DENIED&&(o.positionError=r),o.populate()},{timeout:1e4}):this.populate()},populate:function(t){var e=this,n=function(){e.render(),o(".mz-locationsearch-pleasewait").fadeOut(),e.$el.noFlickerFadeIn()};t?this.model.apiGetByLatLong({location:t}).then(n):this.model.apiGet().then(n)},getRenderContext:function(){var o=e.MozuView.prototype.getRenderContext.apply(this,arguments);return o.model.positionError=this.positionError,o}}),l=d.extend({templateName:"modules/location/location-search",populate:function(t){var e=this;this.model.apiGetForProduct({productCode:this.product.get("variationProductCode")||this.product.get("productCode"),location:t}).then(function(){e.render(),o(".mz-locationsearch-pleasewait").fadeOut(),e.$el.noFlickerFadeIn()})},addToCartForPickup:function(t){var e=o(t.currentTarget),n=e.data("mzLocation");e.parent().addClass("is-loading"),this.product.addToCartForPickup(n)},setProduct:function(t){var e=this;e.product=t,this.listenTo(e.product,"addedtocart",function(){o(window).on("beforeunload",function(){e.$(".is-loading").removeClass("is-loading")}),window.location.href=a.locals.pageContext.secureHost+"/cart"})}});o(document).ready(function(){var t=o("#location-list"),e=i.Product.fromCurrent(),a=!!e.get("productCode"),r=new n.LocationCollection,u=a?l:d,c=new u({model:r,el:t});a&&c.setProduct(e),window.lv=c})}),define("pages/location",function(){});