define(["modules/jquery-mozu","modules/api","vendor/jQuery.selectric"],function(t,e){function i(i){e.request("GET","api/platform/entitylists/partyvendorlist@shindigz/entities?pageSize=20&startIndex=0&filter=state eq "+i).then(function(e){var i=[],a=[],o='<option value="default">Select City</option>';t.each(e.items,function(e,o){-1===t.inArray(o.city,i)?(i.push(o.city),a.push(1)):a[t.inArray(o.city,i)]=a[t.inArray(o.city,i)]+1}),t.each(i,function(t,e){o+='<option value="'+e+'">'+e+" ("+a[t]+")</option>"}),t("#map-city").html(o)},function(t){console.log("Error on load city"),console.log(t)}),console.log("Request Started..!")}function a(){e.request("GET","api/platform/entitylists/partyservicelist@shindigz/entities?pageSize=20").then(function(e){var i='<option value="default">Select Service</option>';console.log("Len "+e.items.length),t.each(e.items,function(t,e){i+='<option value="'+e.service_id+'">'+e.service_name+"</option>"}),t("#map-service").html(i)},function(t){console.log("Error on load service"),console.log(t)})}function o(i,a,o){console.log("Loading storelist"+i+" - "+o),"default"!==o&&"default"!==i&&"default"!==a&&e.request("GET","api/platform/entitylists/partyvendorlist@shindigz/entities?pageSize=200&startIndex=0&filter=state eq "+a+' and city eq "'+i+'" and service_id eq '+o).then(function(e){var i="";e.items.length>0?t.each(e.items,function(t,e){i+=(t+1)%4===0?"<div class='store-item row-store-end'>":"<div class='store-item'>",i+=0!==e.web.length?"<a href='"+e.web+"' target='_blank'>"+e.vendor_name+"</a>":"<a href='javascript:void(0)' target='_blank'>"+e.vendor_name+"</a>",i+="<br />"+e.address+"<br />"+e.city+", "+e.state+"<br />"+e.ph,i+="</div>"}):i="<p>There are currently no "+t("#map-service option:selected").text()+" in "+t("#map-city").val()+"</p>",t(".party-result-title h3 strong:first").text(t("#map-service option:selected").text()),t(".party-result-title p strong:first").text(t("#map-city").val()),t(".party-result-title p strong:last").text(t("#map-service option:selected").text()),t(".party-result-title h3 strong:last").text(t("#map-city").val()+", "+t("#party-state option:selected").text()),t(".party-search-results #mz-drop-zone-party-dir-bottom").css("display","block"),t(".party-search-results .store-list").html(i)},function(t){console.log("Error"),console.log(t)})}a(),t(".map-area map area").click(function(){t("#party-state").val(t(this).attr("acode")),i(t(this).attr("acode")),t("#party-state").removeClass("ani-select").width(),t("#party-state").addClass("ani-select")}),t("#party-state").bind("change",function(){var e=t(this).find("option:selected"),a=e.val();console.log(a),i(a)}),t("#map-city").change(function(){var e=t(this).find("option:selected"),i=e.val();o(i,t("#party-state").val(),t("#map-service").val())}),t("#map-service").change(function(){var e=t(this).find("option:selected"),i=e.val();console.log("service changed "+i),o(t("#map-city").val(),t("#party-state").val(),i)})});