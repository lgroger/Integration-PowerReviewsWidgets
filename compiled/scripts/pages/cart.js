define("modules/preserve-element-through-render",["underscore"],function(e){return function(t,o,n){var r={};t._preserved=t._preserved||{},e.each(o,function(e){r[e]=t.$(e)}),n.call(t),e.each(r,function(e,o){var n=t._preserved[o];e.length>0&&(!n||0===n.length)&&(n=t._preserved[o]=e),n&&n.length>0&&t.$(o).replaceWith(n)})}}),define("modules/eventbus",["underscore","backbone"],function(e,t){return e.extend({},t.Events)}),define("modules/amazonpay",["modules/jquery-mozu","modules/eventbus","modules/api","hyprlivecontext","underscore"],function(e,t,o,n,r){function i(e,o){var n="walletWidgetDiv",r={sellerId:e,onPaymentSelect:function(){t.trigger("aws-card-selected")},design:{designMode:"responsive"},onError:function(e){console.log(e.getErrorCode()),console.log(e.getErrorMessage())}};o&&(n="readOnlyWalletWidgetDiv",r.displayMode="Read",r.amazonOrderReferenceId=o),new window.OffAmazonPayments.Widgets.Wallet(r).bind(n)}function a(e,o){var n="amazonAddressBookWidgetDiv",r={sellerId:e,design:{designMode:"responsive"},onOrderReferenceCreate:function(e){var o=e.getAmazonOrderReferenceId();t.trigger("aws-referenceOrder-created",{orderReferenceId:o})},onAddressSelect:function(){},onError:function(e){console.log("AmazonPay widget errorCode: "+e.getErrorCode()),console.log("AmazonPay widget erorMessage: "+e.getErrorMessage())}};o&&(delete r.onOrderReferenceCreate,delete r.onAddressSelect,r.displayMode="Read",r.amazonOrderReferenceId=o),new window.OffAmazonPayments.Widgets.AddressBook(r).bind(n)}var s={sellerId:"",clientId:"",buttonColor:"",buttonType:"",usePopUp:!0,isEnabled:!1,isScriptLoaded:!1,viewName:"amazon-checkout",init:function(o){var i=r.findWhere(n.locals.siteContext.checkoutSettings.externalPaymentWorkflowSettings,{name:"PayWithAmazon"});if(i&&i.isEnabled){this.isEnabled=i.isEnabled;var a=this.getValue(i,"environment"),s="sandbox"==a,d=this.getValue(i,"region");this.sellerId=this.getValue(i,"sellerId"),this.clientId=this.getValue(i,"clientId"),this.buttonColor=this.getValue(i,"buttonColor")||"Gold",this.buttonType=this.getValue(i,"buttonType")||"PwA",this.usePopUp="true"==(this.getValue(i,"usepopup")||"true"),this.billingType=this.getValue(i,"billingAddressOption");var l={de:"eu",uk:"eu",us:"na",jp:"jp"};if(this.sellerId&&this.clientId&&o){var u=this;window.sandbox=s?"/sandbox":"","us"!=d&&(window.sandbox+="/lpa");var c="https://static-"+l[d]+".payments-amazon.com/OffAmazonPayments/"+d+window.sandbox+"/js/Widgets.js";window.onAmazonLoginReady=function(){window.amazon.Login.setClientId(u.clientId)},e.getScript(c).done(function(){u.isScriptLoaded=!0,t.trigger("aws-script-loaded")}).fail(function(e){console.log(e)})}}},getValue:function(e,t){var o=r.findWhere(e.credentials,{apiName:t});if(o)return o.value},addCheckoutButton:function(e,o){var r=this;if(r.isEnabled){var i=n.locals.pageContext.secureHost;i+=o?"/cart?cartId="+e+"&isAwsCheckout=true&view="+r.viewName:"/checkout/"+e+"?isAwsCheckout=true&view="+r.viewName,t.on("aws-script-loaded",function(){var e;window.OffAmazonPayments.Button("AmazonPayButton",r.sellerId,{type:r.buttonType,color:r.buttonColor,useAmazonAddressBook:!0,size:o?"medium":"small",authorization:function(){var t="profile postal_code payments:widget payments:shipping_address";"1"===r.billingType&&(t+=" payments:billing_address");var o={scope:t,popup:r.usePopUp};e=window.amazon.Login.authorize(o,i)},onError:function(e){console.log("AmazonPay widget errorCode: "+e.getErrorCode()),console.log("AmazonPay widget erorMessage: "+e.getErrorMessage())}})})}},addAddressWidget:function(e){a(this.sellerId,e)},addWalletWidget:function(e){i(this.sellerId,e)}};return s}),define("pages/cart",["modules/backbone-mozu","underscore","modules/jquery-mozu","modules/api","modules/models-cart","modules/cart-monitor","hyprlivecontext","modules/soft-cart","hyprlive","modules/preserve-element-through-render","modules/amazonPay","vendor/wishlist","pages/dndengine","modules/models-product"],function(e,t,o,n,r,i,a,s,d,l,u,c,p,m){{var g;d.getThemeSetting("productAttributes")}window.extrasProducts=[];var h=e.MozuView.extend({templateName:"modules/cart/cart-table",couponsData:{},initialize:function(){var e=this;this.listenTo(this.model,"change:couponCode",this.onEnterCouponCode,this),this.listenTo(this.model,"change:zipCode",this.onEnterZipCode,this),this.codeEntered=!!this.model.get("couponCode"),this.$el.on("keypress","input#coupon-code",function(t){var n=o(t.currentTarget).val();return e.model.set("couponCode",n),e.onEnterCouponCode(e,n),13===t.which?(e.codeEntered&&e.handleEnterKey(),!1):void 0}),this.listenTo(this.model.get("items"),"quantityupdatefailed",this.onQuantityUpdateFailed,this),u.init(r.Cart.fromCurrent().id),u.init(!0);var t=o.cookie("coupon"),n={};"undefined"!=typeof t&&(n=o.parseJSON(t));{var i=this.model.get("couponCodes");this.model.id}console.log(this.model.attributes.couponCodes),o.each(n,function(t,o){if(i.indexOf(t)>=0&&o===!1)try{e.model.apiRemoveCoupon(t).then(function(e){console.log(e)})}catch(n){console.log(n)}})},calculateShippingSurcharge:function(){try{for(var e=this,o=!1,n=e.model.get("items"),r=0,i=0;i<n.models.length;i++){var a=n.models[i].get("product").get("properties"),s=t.where(a,{attributeFQN:d.getThemeSetting("productAttributes").surCharge});s.length>0&&s[0].values[0].value>0&&(n.models[i].set("handlingfee",s[0].values[0].value),r+=parseFloat(s[0].values[0].value)*n.models[i].get("quantity"),o=!0)}e.model.set("enableSurCharge",o);var l=parseFloat(r.toFixed(2));e.model.set("totalSurAmount",l)}catch(u){console.log(u)}},render:function(){console.log("Change "+this.model.hasChanged("discountedTotal"));var t=this;t.showPersonalizeImage(),t.calculateShippingSurcharge(),l(this,[".v-button",".p-button","#AmazonPayButton"],function(){e.MozuView.prototype.render.call(this)}),this.afterRender()},afterRender:function(){if(o.cookie("szcontinueurl")){var e=o.cookie("szcontinueurl");o(".mz-sz-continue").attr("href",e)}else o(".mz-sz-continue").attr("href","/");var t,n=this,r=[],i=[],a="";o("#coupon-code-field ul span strong").each(function(e,t){r[e]=o(t).text()}),r.sort();for(var s=0;s<r.length-1;s++)r[s+1]==r[s]&&(t=r[s]);o("#coupon-code-field ul").each(function(e,n){o(n).find("span strong").text()==t&&(i[e]=e)}),o(i).each(function(e,t){e>0&&o("#coupon-code-field ul:eq("+t+")").remove()}),a=r.filter(function(e,t,o){return t==o.indexOf(e)}),d.getThemeSetting("couponCodeMultiple")||a.length>1&&o(a).each(function(e){if(e>=1){var t=a[e].toLowerCase();n.model.apiRemoveCoupon(t).then(function(){var e=o.cookie("coupon");e&&""!==e&&(n.couponsData=JSON.parse(e)),n.couponsData[t]=!1,o.cookie("coupon",JSON.stringify(n.couponsData),{path:"/",expires:7})})}})},removeCoupon:function(e){var t=this,n=(this.$el,this.model.id,o(e.currentTarget).attr("name"));t.model.apiRemoveCoupon(n).then(function(){var e=o.cookie("coupon");e&&""!==e&&(t.couponsData=JSON.parse(e)),t.couponsData[n]=!1,o.cookie("coupon",JSON.stringify(t.couponsData),{path:"/",expires:7})})},setestimateShipping:function(){{var e=this;parseInt(e.model.get("discountedTotal"),10),parseInt(e.model.get("shippingCost"),10)}e.render()},additionalEvents:{"click input.mz-qtyincrease":"qtyIncrease","click input.mz-qtydecrease":"qtyDecrease","change input.mz-carttable-qty-field":"updateQuantity","click .mz-carttable-item-remove a.mz-icon-close":"removeItem","click .mz-carttable-emptylink":"empty","click button#cart-coupon-code":"addCoupon","click a.remove-coupon-link":"removeCoupon","click .editpersonalize":"editPersonalize","click .code_input_btn":"estimateShippingCost","click a.move-to-wishlist-link":"moveToWishList","click .toggle_components":"toggleComponets","click .editPersonalizeBundleItem":"editPersonalizeBundleItem","click #triggerAmazon":"triggerAmazonPay"},triggerAmazonPay:function(){o("#OffAmazonPaymentsWidgets1").trigger("click")},showPersonalizeImage:function(){for(var e,t,n=this,r=d.getThemeSetting("dndEngineUrl"),i=n.model.get("items"),a=null,s=null,l=0;l<i.length;l++){a=null,s=null;for(var u=0;u<i.models[l].get("product").get("options").length;u++)"tenant~dnd-token"===i.models[l].get("product").get("options")[u].attributeFQN.toLowerCase()&&i.models[l].get("product").get("options")[u].shopperEnteredValue&&""!==i.models[l].get("product").get("options")[u].shopperEnteredValue&&(a=JSON.parse(i.models[l].get("product").get("options")[u].shopperEnteredValue));if(null!==a&&void 0!==a){s={};for(var c in a)if(-1!==c.indexOf("@")){var p=c.split("@")[0];s[p]=a[c]}else s[c]=a[c];i.models[l].set("personslizeIds",s)}if("Bundle"===i.models[l].get("product").get("productUsage"))for(var m=0;m<i.models[l].get("product").get("bundledProducts").length;m++)i.models[l].get("personslizeIds")&&(t=i.models[l].get("personslizeIds")[i.models[l].get("product").get("bundledProducts")[m].productCode],t?(e=r+"preview/"+t,i.models[l].get("product").get("bundledProducts")[m].dndToken=t):e=o('[componentimageid="'+i.models[l].get("id")+"-"+i.models[l].get("product").get("bundledProducts")[m].productCode+'"]').attr("src"),i.models[l].get("product").get("bundledProducts")[m].imageUrl=e);else{var g=i.models[l].get("personslizeIds");for(var h in g)g.hasOwnProperty(h)&&(t=g[h],t&&(e=r+"preview/"+t,i.models[l].get("product").set("imageUrl",e)))}}},toggleComponets:function(e){var t=o(e.currentTarget),n=o(t).data("parent-id"),r=o(e.target).parent().parent().next(".mz-carttable-item-shipping-info").find(".hide_bundle_products").data("parent-id");n==r&&(o('.hide_bundle_products[data-parent-id="'+r+'"]').slideToggle(),t.toggleClass("show_box")),t.hasClass("show_box")?t.html('Hide Components <i class="fa fa-caret-up"></i>'):t.html('Show Components <i class="fa fa-caret-down"></i>')},moveToWishList:function(e){var t=this,n=e.target.id;if(require.mozuData("user").isAnonymous)o("#login").trigger("click");else{var r=t.model.get("items").get(n).get("product");r.set("moveToWishList",1),r.set("cartItemId",n),c.initoWishlist(r)}},estimateShippingCost:function(){{var e=this,t=o('[name="zipcode"]').val();e.model.get("estimateZipValue")}t.length>0?(e.model.set({estimateZipValue:t}),g=e.model.get("estimateZipValue"),e.getZipCodeInfo(e.model.get("estimateZipValue"))):(o(".error-zipCode").text("Please enter valid zip-code").show(),e.model.set("shippingCost",0),e.model.set("estimateZipValue",""),e.model.unset("estimateEntity"),setTimeout(function(){o(".error-zipCode").hide(),e.render()},4e3))},getZipCodeInfo:function(){},getEstimate:function(){var e=this;n.action("entityList","entityList",{listName:"countryus@shindigz"}).then(function(t){console.log(t);for(var o=[],n=0;n<t.length;n++)o.push(t[n].data);e.model.set({estimateEntity:o}),e.render()},function(e){console.log("Error on ship method "),console.log(e)})},enableZipCode:function(){this.$el.find(".code_input_btn").prop("disabled",!1)},getExtraProduct:function(e){var t=null;if(window.extrasProducts.length>0)for(var o=0;o<window.extrasProducts.length;o++)if(window.extrasProducts[o].productCode===e){t=window.extrasProducts[o];break}return t},getSelectedExtrasInfo:function(e){var t=[],o=this,n=e.get("options");if(n.length>0)for(var r=0;r<n.models.length;r++){var i=n.models[r];if("Extra"===i.get("attributeDetail").usageType&&"ProductCode"===i.get("attributeDetail").dataType){var a={};a.name=i.get("attributeDetail").name,a.isRequired=i.get("isRequired"),a.attributeCode=i.get("attributeFQN").split("~")[1],a.values=[];for(var s=i.get("values"),d=0;d<s.length;d++){var l={},u=o.getExtraProduct(s[d].value);l.price=s[d].deltaPrice,l.name=s[d].stringValue,l.value=s[d].value,u&&(l.mfgPartNumber=u.mfgPartNumber);var c=s[d].bundledProduct.inventoryInfo;c&&c.manageStock&&(l.maxQty=c.onlineStockAvailable),l.quantity=s[d].bundledProduct.quantity,a.values.push(l)}t.push(a)}}return t},editPersonalize:function(e){var t,r,i=this,a=JSON.parse(o(e.currentTarget).attr("data-mz-token")),s=null,l=o(e.currentTarget).attr("itemId"),u=this.model.get("items").where({id:l}),c=u[0];window.showPageLoader(),n.on("success",function(e,t){try{var o=t.getResponseHeader("productExtras");if(o&&""!==o){var n=JSON.parse(o);if(n.length>0)for(var r=0;r<n.length;r++)window.extrasProducts.push(n[r])}}catch(i){console.log(i)}}),n.request("get","/api/commerce/catalog/storefront/products/"+c.get("product").get("productCode")+"?my=1").then(function(e){var o=new m.Product(e);for(var n in a)if(a.hasOwnProperty(n)){s=a[n],r=n,-1!==n.indexOf("@")&&(t=n.split("@"),r=t[t.length-1]),c.get("product").set("mfgPartNumber",r);var l=i.getSelectedExtrasInfo(o);l&&c.get("product").set("extrasProductInfo",l)}window.removePageLoader();var u=d.getThemeSetting("dndEngineUrl");u+=s+"/edit";var g=new p.DNDEngine(c,u);g.initialize(),g.send()})},editPersonalizeBundleItem:function(e){var t=o(e.currentTarget).attr("data-mz-token"),r=o(e.currentTarget).attr("itemId"),i=o(e.currentTarget).attr("productCode");n.get("product",i).then(function(e){var o=new m.Product(e.data);o.set("cartlineid",r);var n=d.getThemeSetting("dndEngineUrl");n+=t+"/edit";var i=new p.DNDEngine(o,n);i.initialize(),i.send()})},updateQuantity:t.debounce(function(e){var t=o(e.currentTarget),n=parseInt(t.val(),10),r=t.data("mz-cart-item"),i=this.model.get("items").get(r);i&&!isNaN(n)&&(i.set("quantity",n),i.saveQuantity())},400),onQuantityUpdateFailed:function(e,t){var o=this.$("[data-mz-cart-item="+e.get("id")+"]");o?o.val(t):this.render()},qtyIncrease:function(e){var t=o(e.currentTarget).parent().find("input.mz-carttable-qty-field"),r=parseInt(t.val(),10);if(r+=1,1e5==r&&o(e.currentTarget).parent().find(".mz-qtyincrease").addClass("disabled"),r>1&&1e5>r){t.val(r);var i=t.data("mz-cart-item"),a=this.model.get("items").get(i);a&&!isNaN(r)&&(a.set("quantity",r),a.saveQuantity(),setTimeout(function(){s.update()},2e3))}r>1?o(e.currentTarget).parent().find(".mz-qtydecrease").removeClass("disabled"):o(e.currentTarget).parent().find(".mz-qtydecrease").addClass("disabled"),n.on("error",function(t){"VALIDATION_CONFLICT"==t.errorCode&&t.message.indexOf("out of stock")&&o(e.target).closest("tr").next().find("span.avail-value").html('<span style="color:brown;">Out of stock</span>')})},qtyDecrease:function(e){var t=o(e.currentTarget).parent().find("input.mz-carttable-qty-field"),n=parseInt(t.val(),10);if(n-=1,n>0){t.val(n),o(e.currentTarget).parent().find(".mz-qtyincrease").removeClass("disabled"),n>1?o(e.currentTarget).parent().find(".mz-qtydecrease").removeClass("disabled"):o(e.currentTarget).parent().find(".mz-qtydecrease").addClass("disabled");var r=t.data("mz-cart-item"),i=this.model.get("items").get(r);i&&!isNaN(n)&&(i.set("quantity",n),i.saveQuantity(),setTimeout(function(){s.update()},2e3))}},setOptionValues:function(e,t){var o=e.get("product").get("options"),n=null,r={};if(t.extras){n=JSON.parse(t.extras);for(var i=0;i<n.length;i++)r["tenant~"+n[i].attributeCode]=n[i].value}var a={};a.options=[];for(var s=0;s<o.length;s++)Object.keys(r).length>0&&r[o[s].attributeFQN.toLowerCase()]&&(o[s].value=r[o[s].attributeFQN.toLowerCase()],o[s].shopperEnteredValue=r[o[s].attributeFQN.toLowerCase()]);e.get("product").set("options",o)},updateCartItemPersonalize:function(e){for(var t,r,i=this,a=i.model.get("items").where({id:e.lineitemID}),s=a[0],d=s.get("product").get("options"),l=JSON.parse(e.projectToken),u=0;u<d.length;u++)if("tenant~dnd-token"===d[u].attributeFQN.toLowerCase())if("Bundle"===s.get("product").get("productUsage"))for(var c in l)l.hasOwnProperty(c)&&(t=l[c],r=JSON.parse(d[u].shopperEnteredValue),r[c]=t,d[u].shopperEnteredValue=JSON.stringify(r));else d[u].shopperEnteredValue=e.projectToken,d[u].value=e.projectToken;i.setOptionValues(s,e),n.request("put","api/commerce/carts/current/items/"+s.id,s.toJSON()).then(function(){i.model.apiGet(),o(".dnd-popup").remove(),o("body").css({overflow:"auto"}),o("#cboxOverlay").hide()})},removeItem:function(e){var t=this;if(s.update(),require.mozuData("pagecontext").isEditMode)return!1;var n=o(e.currentTarget),r=n.data("mz-cart-item");return o(".compare-full-error-container").show(),o("#btn-yes-removeitem").data("item-id",r),o(document).on("click","#btn-yes-removeitem",function(){return t.model.removeItem(o(this).data("item-id")),o(".compare-full-error-container").hide(),t.setestimateShipping(),!1}),o("#btn-no-removeitem").on("click",function(){return o(".compare-full-error-container").hide(),!1}),!1},removeCartItem:function(e){var t=this;t.model.removeItem(e)},empty:function(){var e=this;o(document.body).append("<div class='compare-full-error-container'><div class='remove-item-container'><p>Do you want to remove all items?</p><button id='btn-yes-empty' class='btn-remove-item'>OK</button><button id='btn-no-empty' class='btn-remove-item'>Cancel</button></div></div>"),o(document).on("click","#btn-yes-empty",function(){e.model.apiDel().then(function(){window.location.reload()})}),o(document).on("click","#btn-no-empty",function(){return o(".compare-full-error-container").hide(),!1})},proceedToCheckout:function(){this.model.isLoading(!0)},addCoupon:function(){var e=this,t=e.model.get("couponCodes"),n=o("#coupon-code").val().toLowerCase(),r="",i="",a=e.model.get("orderDiscounts");if(t.indexOf(n.toLowerCase())<0){var s=o.cookie("coupon");s&&""!==s&&(e.couponsData=JSON.parse(s)),e.couponsData[n]=!0,o.cookie("coupon",JSON.stringify(e.couponsData),{path:"/",expires:7}),d.getThemeSetting("couponCodeMultiple")?"smtpd"===n?(e.model.unset("couponCode"),e.model.set("couponCode",""),setTimeout(function(){(o("div.mz-messagebar").length>1||""!==o("div.mz-messagebar").html())&&o("div.mz-messagebar:eq(0)").html('<ul class="is-showing mz-errors"><li class="mz-error-item">Please apply Military Coupon Code in checkout page.</li></ul>')},1e3),o("html, body").animate({scrollTop:o("div.cart-main-container").offset().top-100},300)):(e.model.set("couponCode",n),this.model.addCoupon().ensure(function(){e.$el.removeClass("is-loading"),e.model.unset("couponCode"),o(e.model.get("orderDiscounts")).each(function(e,t){console.log(t)}),e.render()})):(o(e.model.apiModel.data.items).each(function(e,t){t.productDiscounts.length>0&&(r=!0)}),e.model.get("orderDiscounts").length>0&&o(e.model.get("orderDiscounts")).each(function(e,t){i=null!==t.couponCode&&void 0!==t.couponCode?!1:!0}),i===!1||r?(e.model.unset("couponCode"),e.model.set("couponCode",""),setTimeout(function(){(o("div.mz-messagebar").length>1||""!==o("div.mz-messagebar").html())&&o("div.mz-messagebar:eq(0)").html('<ul class="is-showing mz-errors"><li class="mz-error-item">Sorry, only one promo code per order.</li></ul>')},1e3),o("html, body").animate({scrollTop:o("div.cart-main-container").offset().top-100},300)):"smtpd"===n?(e.model.unset("couponCode"),e.model.set("couponCode",""),setTimeout(function(){(o("div.mz-messagebar").length>1||""!==o("div.mz-messagebar").html())&&o("div.mz-messagebar:eq(0)").html('<ul class="is-showing mz-errors"><li class="mz-error-item">Please apply Military Coupon Code in checkout page.</li></ul>')},1e3),o("html, body").animate({scrollTop:o("div.cart-main-container").offset().top-100},300)):(e.model.set("couponCode",n),this.model.addCoupon().ensure(function(){e.$el.removeClass("is-loading"),console.log("Invalid Coupon"),e.model.unset("couponCode"),e.render()})))}else o(".coupon-code-stripe").html("Coupon already applied.").css({color:"brown","font-weight":"bold","margin-left":"18%"});a.length<=0&&o(".coupon-code-stripe").html("Invalid Coupon").css({color:"brown","font-weight":"bold","margin-left":"18%"}),setTimeout(function(){o(".coupon-code-stripe").hide().removeAttr("style"),e.render()},4e3)},onEnterZipCode:function(e,t){t&&this.$el.find(".code_input_btn").prop("disabled",!1),t||this.$el.find(".code_input_btn").prop("disabled",!0)},onEnterCouponCode:function(e,t){t&&!this.codeEntered&&(this.codeEntered=!0,this.$el.find("#cart-coupon-code").prop("disabled",!1)),!t&&this.codeEntered&&(this.codeEntered=!1,this.$el.find("#cart-coupon-code").prop("disabled",!0))},autoUpdate:["couponCode","zipCode"],handleEnterKey:function(){this.addCoupon()}});o(document).ready(function(){var e=r.Cart.fromCurrent(),t={cartView:new h({el:o("#cart"),model:e,messagesEl:o("[data-mz-message-bar]")})};e.on("ordercreated",function(t){e.isLoading(!0),window.location="/checkout/"+t.prop("id")}),e.on("sync",function(){i.setCount(e.count())}),window.cartView=t,t.cartView.render(),t.cartView.afterRender(),i.setCount(e.count()),u.isEnabled&&e.count()>0&&u.addCheckoutButton(e.id,!0),o(document).on("click","#login-popover-close,a#login,a#float-login",function(){o(".chkout-login-action").hide(),o(".default-hide").hide()}),o(document).on("click",".cont-to-signup-chkout",function(){o(".trigger-signup").trigger("click"),o("#cboxOverlay").show()})})});